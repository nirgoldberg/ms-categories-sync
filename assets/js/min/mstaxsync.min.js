/*! ms-tax-sync 2019-09-29 */

var $=jQuery,mstaxsync={params:{relationship_fields:$(".mstaxsync-relationship"),rtl:$("html").attr("dir")&&"rtl"==$("html").attr("dir")},$list:function(s){return $("."+s+"-list")},rsGetInputName:function(s){return s.data("name")},rsNewValue:function(s){return['<li class="new">',"<div>",'<input type="hidden" name="'+mstaxsync.rsGetInputName(s.field)+'[]" value="'+s.id+'" />','<span class="mstaxsync-rel-item" data-id="'+s.id+'">','<span class="val">'+s.text+"</span>",'<input type="text" placeholder="'+s.text+'" />','<span class="ind">('+_mstaxsync.relationship_new_item_str+")</span>",'<span class="edit dashicons dashicons-edit"></span>','<span class="ok dashicons dashicons-yes"></span>','<span class="cancel dashicons dashicons-no"></span>','<a href="#" class="remove dashicons dashicons-minus" data-name="remove_item"></a>',"</span>","</div>","</li>"].join("")},init:function(){mstaxsync.relationship()},relationship:function(){mstaxsync.params.relationship_fields.length&&($(".choices-list li .mstaxsync-rel-item").click(function(){mstaxsync.rsOnClickAdd($(this))}),$("body").on("click",".values-list li .remove",function(){mstaxsync.rsOnClickRemove($(this))}),$("body").on("click",".values-list li .edit",function(){mstaxsync.rsOnClickEdit($(this))}),$("body").on("click",".values-list li .ok",function(){mstaxsync.rsOnClickSubmitEdit($(this))}),$("body").on("keypress",".values-list li input",function(s){mstaxsync.rsOnKeypressSubmitEdit(s)}),$("body").on("click",".values-list li .cancel",function(){mstaxsync.rsOnClickCancelEdit($(this))}),mstaxsync.relationshipNestedSortable())},rsOnClickAdd:function(s){var i=s.closest(mstaxsync.params.relationship_fields);if(s.hasClass("disabled"))return!1;s.addClass("disabled");var n=mstaxsync.rsNewValue({field:i,id:s.data("id"),text:s.children("span.val").text()});i.find(mstaxsync.$list("values")).append(n)},rsOnClickRemove:function(s){var i=s.closest(mstaxsync.params.relationship_fields),n=s.parent().data("id"),t=s.closest("li"),e=t.children("ul"),a=t.siblings(),l=i.find(mstaxsync.$list("choices")).find("li .mstaxsync-rel-item[data-id="+n+"]");a.length||t.parent("ul").hasClass("list")||e.length||t.unwrap("ul"),e.length?(t.children("div").remove(),e.children("li").unwrap("ul").unwrap("li")):t.remove(),l.removeClass("disabled")},rsOnClickEdit:function(s){var i=s.closest(".mstaxsync-rel-item"),n=i.children("input");i.addClass("editing"),n.focus()},rsOnClickSubmitEdit:function(s){var i=s.closest(".mstaxsync-rel-item"),n=i.children("span.val"),t=i.children("input");t.val().length&&(n.text(t.val()),t.attr("placeholder",n.text()),t.val(""),mstaxsync.rsIndicateChanged(i.closest("li"))),i.removeClass("editing")},rsOnKeypressSubmitEdit:function(s){"13"==(s.keyCode?s.keyCode:s.which)&&mstaxsync.rsOnClickSubmitEdit($(s.target)),s.stopPropagation()},rsOnClickCancelEdit:function(s){var i=s.closest(".mstaxsync-rel-item");i.children("input").val(""),i.removeClass("editing")},rsIndicateChanged:function(s){var i=s.find(".mstaxsync-rel-item").first(),n=i.children("span.ind"),t=i.children("span.edit");s.addClass("changed"),n.length||$('<span class="ind">('+_mstaxsync.relationship_changed_item_str+")</span>").insertBefore(t)},relationshipNestedSortable:function(){$(".values-list").nestedSortable({listType:"ul",items:"li",handle:"div",toleranceElement:"> div",opacity:.6,revert:250,rtl:mstaxsync.params.rtl,relocate:function(s,i){mstaxsync.rsIndicateChanged(i.item)}})}};$(mstaxsync.init);