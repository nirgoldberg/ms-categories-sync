/*! ms-tax-sync 2019-09-28 */

var $=jQuery,mstaxsync={params:{relationship_fields:$(".mstaxsync-relationship"),rtl:$("html").attr("dir")&&"rtl"==$("html").attr("dir")},$list:function(s){return $("."+s+"-list")},getInputName:function(s){return s.data("name")},newValue:function(s){return['<li class="new">',"<div>",'<input type="hidden" name="'+mstaxsync.getInputName(s.field)+'[]" value="'+s.id+'" />','<span class="mstaxsync-rel-item" data-id="'+s.id+'">'+s.text,"<span>("+_mstaxsync.relationship_new_item_str+")</span>",'<a href="#" class="mstaxsync-icon" data-name="remove_item"></a>',"</span>","</div>","</li>"].join("")},init:function(){mstaxsync.relationship()},relationship:function(){mstaxsync.params.relationship_fields.length&&($(".choices-list li span").click(function(){mstaxsync.onClickAdd($(this))}),$("body").on("click",".values-list li .mstaxsync-icon",function(){mstaxsync.onClickRemove($(this))}),mstaxsync.relationshipNestedSortable())},onClickAdd:function(s){var t=s.closest(mstaxsync.params.relationship_fields);if(s.hasClass("disabled"))return!1;s.addClass("disabled");var n=mstaxsync.newValue({field:t,id:s.data("id"),text:s.html()});t.find(mstaxsync.$list("values")).append(n)},onClickRemove:function(s){var t=s.closest(mstaxsync.params.relationship_fields),n=s.parent().data("id"),a=s.closest("li"),i=a.children("ul"),e=a.siblings(),l=t.find(mstaxsync.$list("choices")).find("li span[data-id="+n+"]");e.length||a.parent("ul").hasClass("list")||i.length||a.unwrap("ul"),i.length?(a.children("div").remove(),i.children("li").unwrap("ul").unwrap("li")):a.remove(),l.removeClass("disabled")},relationshipNestedSortable:function(){$(".values-list").nestedSortable({listType:"ul",items:"li",handle:"div",toleranceElement:"> div",opacity:.6,revert:250,rtl:mstaxsync.params.rtl,relocate:function(s,t){t.item.addClass("changed");var n=t.item.find(".mstaxsync-rel-item").first();n.children("span").length||$("<span>("+_mstaxsync.relationship_changed_item_str+")</span>").appendTo(n)}})}};$(mstaxsync.init);