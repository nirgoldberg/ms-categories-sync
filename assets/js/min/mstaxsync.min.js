/*! ms-tax-sync 2019-09-27 */

var $=jQuery,mstaxsync={params:{relationship_fields:$(".mstaxsync-relationship"),rtl:$("html").attr("dir")&&"rtl"==$("html").attr("dir")},$list:function(s){return $("."+s+"-list")},getInputName:function(s){return s.data("name")},newValue:function(s){return["<li>","<div>",'<input type="hidden" name="'+mstaxsync.getInputName(s.field)+'[]" value="'+s.id+'" />','<span data-id="'+s.id+'" class="mstaxsync-rel-item">'+s.text,'<a href="#" class="mstaxsync-icon" data-name="remove_item"></a>',"</span>","</div>","</li>"].join("")},init:function(){mstaxsync.relationship()},relationship:function(){mstaxsync.params.relationship_fields.length&&($(".choices-list li span").click(function(){mstaxsync.onClickAdd($(this))}),$("body").on("click",".values-list li .mstaxsync-icon",function(){mstaxsync.onClickRemove($(this))}),$(".values-list").nestedSortable({listType:"ul",items:"li",handle:"div",toleranceElement:"> div",opacity:.6,revert:250,rtl:mstaxsync.params.rtl}))},onClickAdd:function(s){var i=s.closest(mstaxsync.params.relationship_fields);if(s.hasClass("disabled"))return!1;s.addClass("disabled");var t=mstaxsync.newValue({field:i,id:s.data("id"),text:s.html()});i.find(mstaxsync.$list("values")).append(t)},onClickRemove:function(s){var i=s.closest(mstaxsync.params.relationship_fields),t=s.parent().data("id"),a=s.closest("li"),n=a.children("ul"),e=a.siblings(),l=i.find(mstaxsync.$list("choices")).find("li span[data-id="+t+"]");e.length||a.parent("ul").hasClass("list")||n.length||a.unwrap("ul"),n.length?(a.children("div").remove(),n.children("li").unwrap("ul").unwrap("li")):a.remove(),l.removeClass("disabled")}};$(mstaxsync.init);